<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Preloader (robust)</title>

  <!-- load jQuery only if missing -->
  <script>
    if (typeof jQuery === 'undefined') {
      document.write('<script src="https://code.jquery.com/jquery-3.6.0.min.js"><\/script>');
    }
  </script>

  <style>
    /* Preloader overlay */
    #preloader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      z-index: 99999;
    }

    /* Loader image (pulse) */
    #preloader img {
      width: 100px;
      max-width: 25vw;
      animation: pulse 1.5s infinite ease-in-out;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Site content starts hidden (opacity) — not display:none */
    #site-content {
      opacity: 0;
      transition: opacity 0.6s ease;
      pointer-events: none; /* prevent interaction until visible */
    }

    /* Prevent scrolling while preloader is active */
    .no-scroll { overflow: hidden; }
  </style>

  <!-- noscript fallback — when JS is disabled, show content and hide preloader -->
  <noscript>
    <style>
      #preloader { display: none !important; }
      #site-content { opacity: 1 !important; pointer-events: auto !important; }
      .no-scroll { overflow: auto !important; }
    </style>
  </noscript>
</head>
<body class="no-scroll">
  <!-- Preloader -->
  <div id="preloader">
    <img src="../images/bouncing-circles.svg" alt="Loading..." />
  </div>

  <!-- Page content — wrap everything here so we don't have to manipulate <body> display -->
  <div id="site-content">
    <main>
      <h1>Hello, world!</h1>
      <p>This is the page content that fades in after the preloader finishes.</p>
      <!-- rest of page -->
    </main>
  </div>

  <script>
  (function () {
    var MIN_MS = 2000;
    var start = Date.now();

    function forceBodyIfHidden() {
      try {
        if (getComputedStyle(document.body).display === 'none') {
          // As a last-resort override, set inline style with !important
          document.body.style.setProperty('display', 'block', 'important');
        }
      } catch (e) { /* ignore cross-origin/style errors */ }
    }

    function revealPageVanilla() {
      var pre = document.getElementById('preloader');
      if (pre) {
        pre.style.transition = 'opacity 0.6s ease';
        pre.style.opacity = '0';
        setTimeout(function () {
          if (pre.parentNode) pre.parentNode.removeChild(pre);
        }, 620);
      }

      // remove scroll lock and show content
      document.body.classList.remove('no-scroll');
      // If some stray CSS kept body hidden, force it now
      forceBodyIfHidden();

      setTimeout(function () {
        var content = document.getElementById('site-content');
        if (content) {
          content.style.opacity = '1';
          content.style.pointerEvents = 'auto';
        }
      }, 20);
    }

    function runWithjQuery() {
      $(window).on('load', function () {
        var elapsed = Date.now() - start;
        var wait = Math.max(0, MIN_MS - elapsed);
        setTimeout(function () {
          $('#preloader').fadeOut(600, function () {
            // ensure body visible if some other CSS hid it
            forceBodyIfHidden();
            $('body').removeClass('no-scroll');
            $('#site-content').animate({ opacity: 1 }, 600, function () {
              $(this).css('pointer-events', 'auto');
            });
            $(this).remove();
          });
        }, wait);
      });
    }

    function runWithoutjQuery() {
      window.addEventListener('load', function () {
        var elapsed = Date.now() - start;
        var wait = Math.max(0, MIN_MS - elapsed);
        setTimeout(revealPageVanilla, wait);
      });
    }

    if (typeof jQuery !== 'undefined') runWithjQuery();
    else runWithoutjQuery();
  })();
  </script>
</body>
</html>